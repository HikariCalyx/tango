syntax = "proto3";

package tango.lobby;

message GameInfo {
  message Patch {
    string name = 1;
    string version = 2;
  }

  string rom = 1;
  Patch patch = 2;
}

message Settings {
  bool open = 1;
  enum MatchType {
    UNKNOWN = 0;
    SINGLE = 1;
    TRIPLE = 2;
  }
  MatchType match_type = 2;
}

message CreateStreamToServerMessage {
  message CreateRequest {
    string nickname = 1;
    GameInfo game_info = 2;
    repeated GameInfo available_games = 3;
    Settings settings = 4;
  }

  message AcceptRequest { bytes save_data = 1; }

  oneof which {
    CreateRequest create_req = 1;
    AcceptRequest accept_req = 2;
  }
}

message CreateStreamToClientMessage {
  message CreateResponse { string lobby_id = 1; }

  message ProposeIndication {
    string opponent_nickname = 1;
    GameInfo game_info = 2;
  }

  message AcceptResponse {
    message Error {
      enum Reason {
        UNKNOWN = 0;
        NO_SUCH_OPPONENT = 1;
      }
      Reason reason = 1;
    }
    message Ok {
      string session_id = 1;
      bytes opponent_save_data = 2;
    }
    oneof which {
      Ok ok = 1;
      Error error = 2;
    }
  }

  message TimeoutIndication {}

  oneof which {
    TimeoutIndication timeout_ind = 1;
    CreateResponse create_resp = 2;
    ProposeIndication propose_ind = 3;
    AcceptResponse accept_resp = 4;
  }
}

message JoinStreamToServerMessage {
  message JoinRequest {
    string lobby_id = 1;
    string nickname = 2;
  }

  message ProposeRequest {
    GameInfo game_info = 2;
    bytes save_data = 3;
  }

  oneof which {
    JoinRequest join_req = 1;
    ProposeRequest propose_req = 2;
  }
}

message JoinStreamToClientMessage {
  message JoinResponse {
    message Info {
      string opponent_nickname = 1;
      GameInfo game_info = 2;
      repeated GameInfo available_games = 3;
      Settings settings = 4;
    }
    Info info = 1;
  }

  message ProposeResponse {
    string session_id = 1;
    bytes opponent_save_data = 2;
  }

  message TimeoutIndication {}

  oneof which {
    TimeoutIndication timeout_ind = 1;
    JoinResponse join_resp = 2;
    ProposeResponse propose_resp = 3;
  }
}
