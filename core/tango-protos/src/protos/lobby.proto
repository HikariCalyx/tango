syntax = "proto3";

package tango.lobby;

message Patch {
  string name = 1;
  string version = 2;
}

message GameInfo {
  string rom_name = 1;
  Patch patch = 2;
}

message Settings { bool open = 1; }

message CreateStreamToServerMessage {
  message CreateRequest {
    string identity_token = 1;
    GameInfo game_info = 2;
    repeated Patch available_patches = 3;
    Settings settings = 4;
    bytes save_data = 5;
  }

  message AcceptRequest { string opponent_id = 1; }

  message RejectRequest { string opponent_id = 1; }

  oneof which {
    CreateRequest create_req = 1;
    AcceptRequest accept_req = 2;
    RejectRequest reject_req = 3;
  }
}

message CreateStreamToClientMessage {
  message CreateResponse { string lobby_id = 1; }

  message JoinIndication {
    string opponent_id = 1;
    string opponent_nickname = 2;
    GameInfo game_info = 3;
  }

  message AcceptResponse {
    string session_id = 1;
    bytes save_data = 2;
  }

  message RejectResponse {}

  oneof which {
    CreateResponse create_resp = 1;
    JoinIndication join_ind = 2;
    AcceptResponse accept_resp = 3;
    RejectResponse reject_resp = 4;
  }
}

message JoinStreamToServerMessage {
  message JoinRequest {
    string identity_token = 1;
    string lobby_id = 2;
    GameInfo game_info = 3;
    bytes save_data = 4;
  }

  oneof which { JoinRequest join_req = 1; }
}

message JoinStreamToClientMessage {
  message JoinResponse {
    string opponent_id = 1;
    string opponent_nickname = 2;
    GameInfo game_info = 3;
    Settings settings = 4;
  }

  message AcceptIndication {
    string session_id = 1;
    bytes save_data = 2;
  }

  oneof which {
    JoinResponse join_resp = 1;
    AcceptIndication accept_ind = 2;
  }
}

message QueryRequest {
  string identity_token = 1;
  string lobby_id = 2;
}

message QueryResponse {
  GameInfo game_info = 1;
  repeated Patch available_patches = 2;
  Settings settings = 3;
}
